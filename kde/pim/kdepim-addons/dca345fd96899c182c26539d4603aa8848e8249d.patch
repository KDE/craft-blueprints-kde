From dca345fd96899c182c26539d4603aa8848e8249d Mon Sep 17 00:00:00 2001
From: Laurent Montel <montel@kde.org>
Date: Wed, 20 Aug 2025 13:08:19 +0200
Subject: [PATCH] Make optional kitinerary => if will stop craft build failed

---
 CMakeLists.txt                                         | 10 +++++++++-
 plugins/messageviewer/CMakeLists.txt                   |  4 +++-
 plugins/messageviewer/bodypartformatter/CMakeLists.txt |  4 +++-
 3 files changed, 15 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index e754395a5..5619d276f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -8,6 +8,7 @@ project(kdepim-addons VERSION ${PIM_VERSION})
 set(KF_MIN_VERSION "6.15.0")
 set(QT_REQUIRED_VERSION "6.8.0")
 set(CMAKE_CXX_STANDARD 20)
+set(CMAKE_CXX_SCAN_FOR_MODULES OFF)
 find_package(ECM ${KF_MIN_VERSION} CONFIG REQUIRED)
 set(CMAKE_MODULE_PATH
     ${CMAKE_CURRENT_SOURCE_DIR}/cmake/modules/
@@ -231,7 +232,14 @@ find_package(
     REQUIRED
 )
 find_package(KPim6PkPass ${KPIMPKPASS_LIB_VERSION} CONFIG REQUIRED)
-find_package(KPim6Itinerary ${KPIMITINERARY_LIB_VERSION} CONFIG REQUIRED)
+find_package(KPim6Itinerary ${KPIMITINERARY_LIB_VERSION} CONFIG)
+set_package_properties(
+                KPim6Itinerary
+                PROPERTIES
+		DESCRIPTION "Allow to build itinerary plugins"
+                    TYPE OPTIONAL
+            )
+
 find_package(KPim6LdapWidgets ${KLDAP_LIB_VERSION} CONFIG REQUIRED)
 find_package(KF6TextTemplate CONFIG REQUIRED)
 
diff --git a/plugins/messageviewer/CMakeLists.txt b/plugins/messageviewer/CMakeLists.txt
index bcacb863c..3f3754773 100644
--- a/plugins/messageviewer/CMakeLists.txt
+++ b/plugins/messageviewer/CMakeLists.txt
@@ -1,4 +1,6 @@
 # SPDX-FileCopyrightText: 2015-2025 Laurent Montel <montel@kde.org>
 # SPDX-License-Identifier: BSD-3-Clause
 add_subdirectory(bodypartformatter)
-add_subdirectory(ktexttemplate)
+if (TARGET KPim6::Itinerary)
+    add_subdirectory(ktexttemplate)
+endif ()
diff --git a/plugins/messageviewer/bodypartformatter/CMakeLists.txt b/plugins/messageviewer/bodypartformatter/CMakeLists.txt
index 36a77451e..17c7fbbad 100644
--- a/plugins/messageviewer/bodypartformatter/CMakeLists.txt
+++ b/plugins/messageviewer/bodypartformatter/CMakeLists.txt
@@ -9,7 +9,9 @@ add_subdirectory(highlighter)
 add_subdirectory(calendar)
 add_subdirectory(gnupgwks)
 add_subdirectory(pkpass)
-add_subdirectory(itinerary)
+if (TARGET KPim6::Itinerary)
+   add_subdirectory(itinerary)
+endif()
 
 option(
     FORCE_DISCOUNT_LIB
-- 
GitLab

